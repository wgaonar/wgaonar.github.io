I"îØ<p>In this post, I show how to control a pair of DC Motors to move forward, backward, and turn left or right. I am using the BeagleBone and the driver <a href="https://www.sparkfun.com/datasheets/Robotics/L298_H_Bridge.pdf">L298N</a> which can drive two DC motors. In practice, this driver can be found in a popular red-colored module that has been designed to make it easy to play and interact with DC motors as this <a href="https://lastminuteengineers.com/l298n-dc-stepper-driver-arduino-tutorial/">tutorial</a> shows.</p>

<p>In the <a href="/Post37-BeagleBone_TB6612FNG_Drive/"> first entry</a> dedicated to this driver, you can read about how to drive only one motor with it.</p>

<p>It is important to remember that the logic voltage for the BeagleBone is <font color="red">3.3V</font>. If the user provides a greater voltage, the BeagleBone could be damaged.</p>

<h2 id="circuit-and-components">Circuit and components</h2>

<p>The circuit can be seen in Figure 1. It consists of a L298N driver module , 2 low voltage DC Motors, batteries, and the BeagleBone.</p>

<figure style="text-align: center; 
              margin-left: auto; 
              margin-right: auto;">
    <img src="../assets/images/Post52/Circuit.png" alt="circuit.png" width="100%" />
  <figcaption>
    Figure 1: Circuit to drive a pair of DC motor with the L298N driver.
  </figcaption>
</figure>

<p>The components are:</p>
<ul>
  <li>1 DC Motor driver L298N</li>
  <li>2 DC Motor 5.0 - 6.0V</li>
  <li>4 AA Batteries</li>
  <li>1 Protoboard mini</li>
  <li>Jumpers male-male to make the connections</li>
</ul>

<p>The pins used for control the driver and the motors are:</p>
<ul>
  <li>The pins used for control the <strong>motor A</strong> are:
    <ul>
      <li>GPIO <strong>P8_12</strong> and <strong>P8_14</strong> to control the motor rotation direction</li>
      <li>PWM <strong>P8_13</strong> to control the speed</li>
    </ul>
  </li>
  <li>The pins used for control the <strong>motor B</strong> are:
    <ul>
      <li>GPIO <strong>P8_17</strong> and <strong>P8_18</strong> to control the motor rotation direction</li>
      <li>PWM <strong>P8_19</strong> to control the speed</li>
    </ul>
  </li>
</ul>

<h2 id="coding">Coding</h2>

<p>First, two <code class="language-plaintext highlighter-rouge">DCMotor</code> objects are declared. For that, <code class="language-plaintext highlighter-rouge">GPIO</code> and <code class="language-plaintext highlighter-rouge">PWM</code> objects are declared with global scope to initialize each one of both motors that will be driven.</p>

<p>These objects are named <code class="language-plaintext highlighter-rouge">AIN1</code>, <code class="language-plaintext highlighter-rouge">AIN2</code>, <code class="language-plaintext highlighter-rouge">PWMA</code>, <code class="language-plaintext highlighter-rouge">BIN1</code>, <code class="language-plaintext highlighter-rouge">BIN2</code>, and <code class="language-plaintext highlighter-rouge">PWMB</code> for the <code class="language-plaintext highlighter-rouge">MotorA</code> and <code class="language-plaintext highlighter-rouge">MotorB</code> objects, respectively. These are <code class="language-plaintext highlighter-rouge">DCMotor</code> objects declared as <code class="language-plaintext highlighter-rouge">MotorLeft</code> and <code class="language-plaintext highlighter-rouge">MotorRight</code> and contain methods to set the speed and the spin direction to drive the DC motor and to stop it, as well as, a fourth boolean initialization parameter <code class="language-plaintext highlighter-rouge">true/false</code> to invert by software the motor direction rotation instead of inverting the motor‚Äôs jumpers physically.</p>

<p>As is shown next, I have used this parameter to invert the rotation direction of the <code class="language-plaintext highlighter-rouge">MotorA</code>, setting the last parameter to <code class="language-plaintext highlighter-rouge">true</code>, instead of inverting the jumpers physically. This feature can be useful when you do not have access to the circuit or the motor directly.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1">// Declaring the pins for MotorA </span>
<span class="n">GPIO</span> <span class="nf">AIN1</span> <span class="p">(</span><span class="n">P8_12</span><span class="p">);</span>
<span class="n">GPIO</span> <span class="nf">AIN2</span> <span class="p">(</span><span class="n">P8_14</span><span class="p">);</span>
<span class="n">PWM</span> <span class="nf">PWMA</span> <span class="p">(</span><span class="n">P8_13</span><span class="p">);</span>

<span class="c1">// Declare the MotorA</span>
<span class="n">DCMotor</span> <span class="nf">MotorLeft</span> <span class="p">(</span><span class="n">AIN1</span><span class="p">,</span> <span class="n">AIN2</span><span class="p">,</span> <span class="n">PWMA</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

<span class="c1">// Declaring the  pins for MotorB</span>
<span class="n">GPIO</span> <span class="nf">BIN1</span> <span class="p">(</span><span class="n">P8_17</span><span class="p">);</span>
<span class="n">GPIO</span> <span class="nf">BIN2</span> <span class="p">(</span><span class="n">P8_18</span><span class="p">);</span>
<span class="n">PWM</span> <span class="nf">PWMB</span> <span class="p">(</span><span class="n">P8_19</span><span class="p">);</span>

<span class="c1">// Declare the MotorB</span>
<span class="n">DCMotor</span> <span class="nf">MotorRight</span> <span class="p">(</span><span class="n">BIN1</span><span class="p">,</span> <span class="n">BIN2</span><span class="p">,</span> <span class="n">PWMB</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>These <code class="language-plaintext highlighter-rouge">DCMotor</code> objects are used to initialize the <code class="language-plaintext highlighter-rouge">L298N</code> object with two of them. This inheritance structure has the goal to encapsulate the corresponding methods for any generic DC motor in the <code class="language-plaintext highlighter-rouge">DCMotor</code> object avoiding repeat code in the <code class="language-plaintext highlighter-rouge">L298N</code> object and focusing on the methods to <strong>drive / brake</strong> not only one, but the two motors at the same time and in a different direction if it desired.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Declare the L298N Module</span>
<span class="n">L298N</span> <span class="nf">myL298NModule</span> <span class="p">(</span><span class="n">MotorLeft</span><span class="p">,</span> <span class="n">MotorRight</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">L298N</code> object constructor for two DC Motors is shown in the next listing. To construct the <code class="language-plaintext highlighter-rouge">L298N</code> object, the user has to declare previously, two <code class="language-plaintext highlighter-rouge">DCMotor</code> objects with their respective <code class="language-plaintext highlighter-rouge">GPIO</code> and <code class="language-plaintext highlighter-rouge">PWM</code> pins.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1">// Overload constructor from DCMotor objects and for MotorA and MotorB</span>
<span class="n">L298N</span><span class="o">::</span><span class="n">L298N</span> <span class="p">(</span><span class="n">DCMotor</span><span class="o">&amp;</span> <span class="n">newMotorA</span><span class="p">,</span> 
              <span class="n">DCMotor</span><span class="o">&amp;</span> <span class="n">newMotorB</span><span class="p">)</span><span class="o">:</span>
              <span class="n">MotorA</span> <span class="p">(</span><span class="n">newMotorA</span><span class="p">),</span> 
              <span class="n">MotorB</span> <span class="p">(</span><span class="n">newMotorB</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Set the flags about which motors are used </span>
  <span class="n">motorAisUsed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="n">motorBisUsed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">message</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">swapStringMotorA</span> <span class="p">{</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">swapSpinFlag</span> <span class="o">?</span> <span class="s">"True"</span> <span class="o">:</span> <span class="s">"False"</span><span class="p">};</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">swapStringMotorB</span> <span class="p">{</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">swapSpinFlag</span> <span class="o">?</span> <span class="s">"True"</span> <span class="o">:</span> <span class="s">"False"</span><span class="p">};</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">"</span><span class="se">\n</span><span class="s">TB6612FNG driver module with the next components / pins was created and activated:</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">MotorA:</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">AIN1: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">input1Pin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> 
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">AIN2: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">input2Pin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> 
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">PWMA: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">pwmPin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">Swap Spin: "</span><span class="p">)</span> <span class="o">+</span> <span class="n">swapStringMotorA</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">MotorB:</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">BIN1: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">input1Pin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> 
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">BIN2: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">input2Pin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> 
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">PWMB: "</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">pwmPin</span><span class="p">.</span><span class="n">GetPinHeaderId</span><span class="p">()</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">Swap Spin: "</span><span class="p">)</span> <span class="o">+</span> <span class="n">swapStringMotorB</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span>
            <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">;</span> 
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Light Red"</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this code, I used the next encapsulated methods in the <code class="language-plaintext highlighter-rouge">L298N</code> class to move or turn both DC Motors at the same time which receives as arguments the speed and duration of the movement and the action to do after that movement has been executed:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">L298N::Forward</code> runs the both in the same direction to forward.</li>
  <li><code class="language-plaintext highlighter-rouge">L298N::Backward</code> runs the both in the same direction to backward.</li>
  <li><code class="language-plaintext highlighter-rouge">L298N::TurnLeft</code> turns the motors in opposite directions to get a turn to the left of the robot or body to which the DC motors are attached.</li>
  <li><code class="language-plaintext highlighter-rouge">L298N::TurnRight</code> turns the motors in opposite directions to get a turn to the right of the robot or body to which the DC motors are attached..</li>
</ul>

<p>It is different from the <a href="/Post49-BeagleBone_L298N_Drive/">first entry</a> post of the series, where the inherited <code class="language-plaintext highlighter-rouge">DCMotor::Drive()</code> method was used to drive only one motor with this module. Here, these own <code class="language-plaintext highlighter-rouge">L298N</code> methods are used and are shown in the next listings:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="cm">/*
  Interface method to drive FORWARD both motors
  @param int speed: The desired speed (0,100). It set up the correct value if
                    the user enters a negative value.
  @param int duration:  The desired duration in milliseconds with 0 as
                        default value
  @param STOPMODE action &lt;brake / idle&gt;:  Action on the motor after driving it, 
                                        with &lt;idle&gt; as default action. 
*/</span>
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">Forward</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">STOPMODE</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>  
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DelayMilliseconds</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">idle</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Idle</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Brake</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="cm">/*
  Interface method to drive BACKWARD both motors
  @param int speed: The desired speed (-100,0). It set up the correct value if
                    the user enters a positive value.
  @param int duration:  The desired duration in milliseconds with 0 as 
                        default value
  @param STOPMODE action &lt;brake / idle&gt;:  Action on the motor after driving it with 
                                        &lt;idle&gt; as default action.   
*/</span>
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">Backward</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">STOPMODE</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>  
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DelayMilliseconds</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">idle</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Idle</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Brake</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="cm">/*
  Interface method to DRIVE in OPPOSITE direction both motors
  @param int speed: The desired speed (0,100). It set up the correct value if
                    the user enters a positive value.
  @param int duration:  The desired duration in milliseconds with 0 as 
                        default value
  @param STOPMODE action &lt;brake / idle&gt;:  Action on the motor after driving it with 
                                        &lt;idle&gt; as default action.   
*/</span>
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">TurnLeft</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">STOPMODE</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="o">-</span><span class="n">speed</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>  
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DelayMilliseconds</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">idle</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Idle</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Brake</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="cm">/*
  Interface method to DRIVE in ANOTHER OPPOSITE direction both motors
  @param int speed: The desired speed (0,100). It set up the correct value if
                    the user enters a positive value.
  @param int duration:  The desired duration in milliseconds with 0 as 
                        default value
  @param STOPMODE action &lt;brake / idle&gt;:  Action on the motor after driving it with 
                                        &lt;idle&gt; as default action.   
*/</span>
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">TurnRight</span><span class="p">(</span><span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">STOPMODE</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">speed</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">speed</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="n">speed</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>  
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Drive</span><span class="p">(</span><span class="o">-</span><span class="n">speed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">DelayMilliseconds</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">idle</span><span class="p">)</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Idle</span><span class="p">();</span>
    <span class="k">else</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">Brake</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the implementation, the user can change the motor speed using the key ‚ÄúW‚Äù and ‚ÄúS‚Äù to increase or decrease it, respectively. The library does not let to set a speed value beyond the limits of <font color="red">100 and -100</font>. If the user presses the key ‚ÄúY‚Äù, the program finishes.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">motorSpeed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">userInput</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">userInput</span> <span class="o">!=</span> <span class="sc">'y'</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">"Enter an option 'y', 'w', 's', 'a', 'd': "</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">);</span>
  <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">userInput</span><span class="p">;</span>

  <span class="c1">// Update the motors speed and move the motors in 4 directions</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">userInput</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">case</span> <span class="sc">'w'</span><span class="p">:</span>
    <span class="n">myL298NModule</span><span class="p">.</span><span class="n">Forward</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sc">'s'</span><span class="p">:</span>
    <span class="n">myL298NModule</span><span class="p">.</span><span class="n">Backward</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sc">'a'</span><span class="p">:</span>
    <span class="n">myL298NModule</span><span class="p">.</span><span class="n">TurnLeft</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="sc">'d'</span><span class="p">:</span>
    <span class="n">myL298NModule</span><span class="p">.</span><span class="n">TurnRight</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="nl">default:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>  
</pre></td></tr></tbody></table></code></pre></div></div>

<p>To complement the behavior of the <code class="language-plaintext highlighter-rouge">L298N</code>class, the <code class="language-plaintext highlighter-rouge">Brake()</code> and <code class="language-plaintext highlighter-rouge">Idle()</code> methods are defined too. These methods set the correct pins state of the L298N module for getting a brake or idle state in the DC motor. These methods are shown in the next listings:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="cm">/*
  Interface method to BRAKE the attached motors to the module 
*/</span> 
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">Brake</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Set the motor A in brake mode</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>

  <span class="c1">// Set the motor B in brake mode if it is used</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*
  Interface method to IDLE the attached motors to the module 
*/</span> 
<span class="kt">void</span> <span class="n">L298N</span><span class="o">::</span><span class="n">Idle</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Set the motor A in idle mode</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorAisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorA</span><span class="p">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">LOW</span><span class="p">,</span> <span class="n">LOW</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>

  <span class="c1">// Set the motor B in idle mode if it is used</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">motorBisUsed</span><span class="p">)</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MotorB</span><span class="p">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">LOW</span><span class="p">,</span> <span class="n">LOW</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The complete code for this application uses a <code class="language-plaintext highlighter-rouge">while loop</code> to control both motors increasing and decreasing the speed until the user press the key ‚ÄúY‚Äù. This code is shown in the next listing.</p>

<h3 id="l298n_14cpp">L298N_1.4.cpp</h3>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="rouge-code"><pre><span class="cm">/******************************************************************************
L298N_1.4.cpp
@wgaonar
26/03/2022
https://github.com/wgaonar/BeagleCPP

- Move TWO motors forward, backward, turning left or right at max speed

Class: L298N
******************************************************************************/</span>
<span class="cp">#include &lt;iostream&gt;
#include "../../../Sources/L298N.h"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="c1">// Declaring the pins for MotorA </span>
<span class="n">GPIO</span> <span class="nf">AIN1</span> <span class="p">(</span><span class="n">P8_12</span><span class="p">);</span>
<span class="n">GPIO</span> <span class="nf">AIN2</span> <span class="p">(</span><span class="n">P8_14</span><span class="p">);</span>
<span class="n">PWM</span> <span class="nf">PWMA</span> <span class="p">(</span><span class="n">P8_13</span><span class="p">);</span>

<span class="c1">// Declare the MotorA</span>
<span class="n">DCMotor</span> <span class="nf">MotorLeft</span> <span class="p">(</span><span class="n">AIN1</span><span class="p">,</span> <span class="n">AIN2</span><span class="p">,</span> <span class="n">PWMA</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

<span class="c1">// Declaring the  pins for MotorB</span>
<span class="n">GPIO</span> <span class="nf">BIN1</span> <span class="p">(</span><span class="n">P8_17</span><span class="p">);</span>
<span class="n">GPIO</span> <span class="nf">BIN2</span> <span class="p">(</span><span class="n">P8_18</span><span class="p">);</span>
<span class="n">PWM</span> <span class="nf">PWMB</span> <span class="p">(</span><span class="n">P8_19</span><span class="p">);</span>

<span class="c1">// Declare the MotorB</span>
<span class="n">DCMotor</span> <span class="nf">MotorRight</span> <span class="p">(</span><span class="n">BIN1</span><span class="p">,</span> <span class="n">BIN2</span><span class="p">,</span> <span class="n">PWMB</span><span class="p">);</span>

<span class="c1">// Declare the L298N Module</span>
<span class="n">L298N</span> <span class="nf">myL298NModule</span> <span class="p">(</span><span class="n">MotorLeft</span><span class="p">,</span> <span class="n">MotorRight</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">string</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"Main program starting here..."</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="s">"Blue"</span><span class="p">,</span> <span class="s">"White"</span><span class="p">,</span> <span class="s">"Bold"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

  <span class="n">message</span> <span class="o">=</span> <span class="s">"If you want to stop the program, enter 'y' for yes"</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">"Or enter 'w' to move forward 's' to move to backward"</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s">"Or enter 'a' to move to the left or 'd' to move to the right"</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">motorSpeed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">userInput</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">userInput</span> <span class="o">!=</span> <span class="sc">'y'</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s">"Enter an option 'y', 'w', 's', 'a', 'd': "</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">"Yellow"</span><span class="p">);</span>
    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">userInput</span><span class="p">;</span>

    <span class="c1">// Update the motors speed and move the motors in 4 directions</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">userInput</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="sc">'w'</span><span class="p">:</span>
      <span class="n">myL298NModule</span><span class="p">.</span><span class="n">Forward</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sc">'s'</span><span class="p">:</span>
      <span class="n">myL298NModule</span><span class="p">.</span><span class="n">Backward</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sc">'a'</span><span class="p">:</span>
      <span class="n">myL298NModule</span><span class="p">.</span><span class="n">TurnLeft</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="sc">'d'</span><span class="p">:</span>
      <span class="n">myL298NModule</span><span class="p">.</span><span class="n">TurnRight</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="nl">default:</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>  

  <span class="c1">// Brake the motors</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Breaking the motors...</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="n">myL298NModule</span><span class="p">.</span><span class="n">Brake</span><span class="p">();</span>

  <span class="n">message</span> <span class="o">=</span> <span class="s">"Main program finishes here..."</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">RainbowText</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="s">"Blue"</span><span class="p">,</span> <span class="s">"White"</span><span class="p">,</span><span class="s">"Bold"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Se you in the next post.</p>
:ET